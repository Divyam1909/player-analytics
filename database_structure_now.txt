-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.duels (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  team_id uuid NOT NULL,
  player_id uuid NOT NULL,
  minute integer CHECK (minute >= 0 AND minute <= 130),
  second integer CHECK (second >= 0 AND second <= 59),
  duel_x real CHECK (duel_x >= 0::double precision AND duel_x <= 100::double precision),
  duel_y real CHECK (duel_y >= 0::double precision AND duel_y <= 100::double precision),
  duel_type text NOT NULL CHECK (duel_type = ANY (ARRAY['aerial'::text, 'dribble'::text])),
  is_successful boolean NOT NULL,
  opponent_player_id uuid,
  is_progressive_carry boolean DEFAULT false,
  progressive_carry_location text CHECK (progressive_carry_location = ANY (ARRAY['inside_box'::text, 'outside_box'::text])),
  players_outplayed_count integer DEFAULT 0 CHECK (players_outplayed_count >= 0),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT duels_pkey PRIMARY KEY (id),
  CONSTRAINT duels_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT duels_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT duels_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id),
  CONSTRAINT duels_opponent_player_id_fkey FOREIGN KEY (opponent_player_id) REFERENCES public.players(id)
);
CREATE TABLE public.final_third_chances (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  team_id uuid NOT NULL,
  player_id uuid NOT NULL,
  minute integer CHECK (minute >= 0 AND minute <= 130),
  second integer CHECK (second >= 0 AND second <= 59),
  chance_x real CHECK (chance_x >= 0::double precision AND chance_x <= 100::double precision),
  chance_y real CHECK (chance_y >= 0::double precision AND chance_y <= 100::double precision),
  is_in_box boolean NOT NULL,
  is_corner boolean DEFAULT false,
  corner_side text CHECK (corner_side = ANY (ARRAY['left'::text, 'right'::text])),
  corner_type text CHECK (corner_type = ANY (ARRAY['short'::text, 'long'::text])),
  long_corner_success boolean,
  location_in_box text CHECK (location_in_box = ANY (ARRAY['left'::text, 'centre'::text, 'right'::text])),
  related_pass_event_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT final_third_chances_pkey PRIMARY KEY (id),
  CONSTRAINT final_third_chances_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT final_third_chances_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT final_third_chances_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id),
  CONSTRAINT final_third_chances_related_pass_event_id_fkey FOREIGN KEY (related_pass_event_id) REFERENCES public.pass_events(id)
);
CREATE TABLE public.fouls (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  fouling_team_id uuid NOT NULL,
  fouling_player_id uuid NOT NULL,
  fouled_team_id uuid NOT NULL,
  fouled_player_id uuid NOT NULL,
  minute integer CHECK (minute >= 0 AND minute <= 130),
  second integer CHECK (second >= 0 AND second <= 59),
  foul_x real CHECK (foul_x >= 0::double precision AND foul_x <= 100::double precision),
  foul_y real CHECK (foul_y >= 0::double precision AND foul_y <= 100::double precision),
  card_given text NOT NULL CHECK (card_given = ANY (ARRAY['yellow'::text, 'red'::text, 'none'::text])),
  resulted_in_freekick boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT fouls_pkey PRIMARY KEY (id),
  CONSTRAINT fouls_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT fouls_fouling_team_id_fkey FOREIGN KEY (fouling_team_id) REFERENCES public.teams(id),
  CONSTRAINT fouls_fouling_player_id_fkey FOREIGN KEY (fouling_player_id) REFERENCES public.players(id),
  CONSTRAINT fouls_fouled_team_id_fkey FOREIGN KEY (fouled_team_id) REFERENCES public.teams(id),
  CONSTRAINT fouls_fouled_player_id_fkey FOREIGN KEY (fouled_player_id) REFERENCES public.players(id)
);
CREATE TABLE public.frame_cache (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  cache_key text NOT NULL UNIQUE,
  video_id text NOT NULL,
  timestamp_seconds real NOT NULL,
  image_url text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT frame_cache_pkey PRIMARY KEY (id)
);
CREATE TABLE public.keeper_actions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  team_id uuid NOT NULL,
  player_id uuid NOT NULL,
  minute integer CHECK (minute >= 0 AND minute <= 130),
  second integer CHECK (second >= 0 AND second <= 59),
  action_x real CHECK (action_x >= 0::double precision AND action_x <= 100::double precision),
  action_y real CHECK (action_y >= 0::double precision AND action_y <= 100::double precision),
  action_type text NOT NULL CHECK (action_type = ANY (ARRAY['save'::text, 'collection'::text, 'goal_conceded'::text])),
  save_location text CHECK (save_location = ANY (ARRAY['inside_box'::text, 'outside_box'::text])),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT keeper_actions_pkey PRIMARY KEY (id),
  CONSTRAINT keeper_actions_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT keeper_actions_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id),
  CONSTRAINT keeper_actions_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id)
);
CREATE TABLE public.knowledge (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  type text NOT NULL,
  title text NOT NULL,
  content text,
  file_url text,
  file_name text,
  summarize boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT knowledge_pkey PRIMARY KEY (id),
  CONSTRAINT knowledge_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.leagues (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  league_name text NOT NULL,
  tier integer CHECK (tier >= 1 AND tier <= 5),
  custom_label text,
  is_default boolean NOT NULL DEFAULT false,
  country text,
  state text,
  district text,
  league_type text CHECK (league_type = ANY (ARRAY['professional'::text, 'youth'::text, 'friendly'::text, 'other'::text])),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT leagues_pkey PRIMARY KEY (id)
);
CREATE TABLE public.match_analytical_maps (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL UNIQUE,
  heatmap_url text,
  touchmap_url text,
  chances_created_final_third_team_url text,
  chances_created_final_third_opponent_url text,
  team_final_third_left text,
  team_final_third_center text,
  team_final_third_right text,
  opponent_final_third_left text,
  opponent_final_third_center text,
  opponent_final_third_right text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT match_analytical_maps_pkey PRIMARY KEY (id),
  CONSTRAINT match_analytical_maps_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id)
);
CREATE TABLE public.match_captured_frames (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  user_id uuid NOT NULL,
  timestamp_seconds double precision NOT NULL,
  formatted_time text NOT NULL,
  original_image_url text NOT NULL,
  annotated_image_url text,
  is_exact_frame boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT match_captured_frames_pkey PRIMARY KEY (id),
  CONSTRAINT match_captured_frames_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT match_captured_frames_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.match_highlights (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  timestamp text NOT NULL,
  highlight_type text NOT NULL CHECK (highlight_type = ANY (ARRAY['goal'::text, 'assist'::text, 'shot_on_target'::text, 'save'::text, 'penalty'::text, 'yellow_card'::text, 'red_card'::text, 'offside'::text, 'corner'::text, 'free_kick'::text, 'substitution'::text, 'chances_created'::text, 'cross'::text, 'other'::text])),
  description text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT match_highlights_pkey PRIMARY KEY (id),
  CONSTRAINT match_highlights_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id)
);
CREATE TABLE public.match_performance (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  minute integer NOT NULL CHECK (minute >= 0 AND minute <= 90),
  home_performance integer NOT NULL CHECK (home_performance >= 0 AND home_performance <= 100),
  away_performance integer NOT NULL CHECK (away_performance >= 0 AND away_performance <= 100),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT match_performance_pkey PRIMARY KEY (id),
  CONSTRAINT match_performance_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id)
);
CREATE TABLE public.match_possession (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  minute integer NOT NULL CHECK (minute >= 0 AND minute <= 90),
  home_possession integer NOT NULL CHECK (home_possession >= 0 AND home_possession <= 100),
  away_possession integer NOT NULL CHECK (away_possession >= 0 AND away_possession <= 100),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT match_possession_pkey PRIMARY KEY (id),
  CONSTRAINT match_possession_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id)
);
CREATE TABLE public.match_video_notes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  timestamp text NOT NULL,
  note_text text NOT NULL,
  home_notes text,
  away_notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT match_video_notes_pkey PRIMARY KEY (id),
  CONSTRAINT match_video_notes_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id)
);
CREATE TABLE public.matches (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  home_team_id uuid NOT NULL,
  away_team_id uuid NOT NULL,
  our_team_id uuid NOT NULL,
  league_id uuid,
  competition_name text NOT NULL,
  match_date date NOT NULL,
  home_score integer NOT NULL DEFAULT 0 CHECK (home_score >= 0),
  away_score integer NOT NULL DEFAULT 0 CHECK (away_score >= 0),
  home_jersey_color character varying,
  away_jersey_color character varying,
  video_url text,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  status text DEFAULT 'scheduled'::text CHECK (status = ANY (ARRAY['scheduled'::text, 'live'::text, 'finished'::text, 'importing'::text])),
  CONSTRAINT matches_pkey PRIMARY KEY (id),
  CONSTRAINT matches_home_team_id_fkey FOREIGN KEY (home_team_id) REFERENCES public.teams(id),
  CONSTRAINT matches_away_team_id_fkey FOREIGN KEY (away_team_id) REFERENCES public.teams(id),
  CONSTRAINT matches_our_team_id_fkey FOREIGN KEY (our_team_id) REFERENCES public.teams(id),
  CONSTRAINT matches_league_id_fkey FOREIGN KEY (league_id) REFERENCES public.leagues(id),
  CONSTRAINT matches_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.pass_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  team_id uuid NOT NULL,
  player_id uuid NOT NULL,
  minute integer CHECK (minute >= 0 AND minute <= 130),
  second integer CHECK (second >= 0 AND second <= 59),
  start_x real CHECK (start_x >= 0::double precision AND start_x <= 100::double precision),
  start_y real CHECK (start_y >= 0::double precision AND start_y <= 100::double precision),
  end_x real CHECK (end_x >= 0::double precision AND end_x <= 100::double precision),
  end_y real CHECK (end_y >= 0::double precision AND end_y <= 100::double precision),
  is_successful boolean NOT NULL,
  receiver_player_id uuid,
  is_progressive_pass boolean DEFAULT false,
  is_key_pass boolean DEFAULT false,
  is_cross boolean DEFAULT false,
  is_assist boolean DEFAULT false,
  outplays_players_count integer DEFAULT 0 CHECK (outplays_players_count >= 0),
  outplays_lines_count integer DEFAULT 0 CHECK (outplays_lines_count >= 0),
  assist_pass_type text CHECK (assist_pass_type = ANY (ARRAY['normal'::text, 'key'::text, 'progressive'::text])),
  cross_pass_type text CHECK (cross_pass_type = ANY (ARRAY['normal'::text, 'key'::text, 'progressive'::text])),
  defending_player_id uuid,
  failure_reason text CHECK (failure_reason = ANY (ARRAY['block'::text, 'clearance'::text, 'interception'::text, 'offside'::text])),
  is_high_press boolean DEFAULT false,
  is_ball_recovery boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT pass_events_pkey PRIMARY KEY (id),
  CONSTRAINT pass_events_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT pass_events_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT pass_events_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id),
  CONSTRAINT pass_events_receiver_player_id_fkey FOREIGN KEY (receiver_player_id) REFERENCES public.players(id),
  CONSTRAINT pass_events_defending_player_id_fkey FOREIGN KEY (defending_player_id) REFERENCES public.players(id)
);
CREATE TABLE public.player_attributes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  player_id uuid NOT NULL UNIQUE,
  passing integer CHECK (passing >= 0 AND passing <= 100),
  shooting integer CHECK (shooting >= 0 AND shooting <= 100),
  dribbling integer CHECK (dribbling >= 0 AND dribbling <= 100),
  defending integer CHECK (defending >= 0 AND defending <= 100),
  physical integer CHECK (physical >= 0 AND physical <= 100),
  overall_rating integer CHECK (overall_rating >= 0 AND overall_rating <= 100),
  is_manual boolean DEFAULT false,
  last_calculated_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT player_attributes_pkey PRIMARY KEY (id),
  CONSTRAINT player_attributes_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id)
);
CREATE TABLE public.player_interview_notes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  player_interview_id uuid NOT NULL,
  user_id uuid NOT NULL,
  timestamp_seconds real NOT NULL CHECK (timestamp_seconds >= 0::double precision),
  note_text text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT player_interview_notes_pkey PRIMARY KEY (id),
  CONSTRAINT player_interview_notes_player_interview_id_fkey FOREIGN KEY (player_interview_id) REFERENCES public.player_interviews(id),
  CONSTRAINT player_interview_notes_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.player_interviews (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  heading text NOT NULL,
  score text,
  youtube_link text,
  team_id uuid NOT NULL,
  home_team_first_half text,
  home_team_second_half text,
  away_team_first_half text,
  away_team_second_half text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT player_interviews_pkey PRIMARY KEY (id),
  CONSTRAINT player_interviews_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id)
);
CREATE TABLE public.players (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  team_id uuid NOT NULL,
  first_name text NOT NULL,
  last_name text,
  jersey_number integer CHECK (jersey_number >= 1 AND jersey_number <= 99),
  position text CHECK ("position" = ANY (ARRAY['GK'::text, 'CB'::text, 'RB'::text, 'LB'::text, 'RWB'::text, 'LWB'::text, 'CM'::text, 'CDM'::text, 'CAM'::text, 'RW'::text, 'LW'::text, 'ST'::text, 'CF'::text])),
  date_of_birth date,
  nationality text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT players_pkey PRIMARY KEY (id),
  CONSTRAINT players_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id)
);
CREATE TABLE public.schema_baseline (
  table_name text NOT NULL,
  created_via text NOT NULL CHECK (created_via = ANY (ARRAY['migration'::text, 'dashboard'::text, 'unknown'::text])),
  first_migration text,
  rls_enabled boolean NOT NULL DEFAULT false,
  notes text,
  documented_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT schema_baseline_pkey PRIMARY KEY (table_name)
);
CREATE TABLE public.set_pieces (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  team_id uuid NOT NULL,
  player_id uuid NOT NULL,
  minute integer CHECK (minute >= 0 AND minute <= 130),
  second integer CHECK (second >= 0 AND second <= 59),
  set_piece_x real CHECK (set_piece_x >= 0::double precision AND set_piece_x <= 100::double precision),
  set_piece_y real CHECK (set_piece_y >= 0::double precision AND set_piece_y <= 100::double precision),
  set_piece_type text NOT NULL CHECK (set_piece_type = ANY (ARRAY['goal_kick'::text, 'free_kick'::text, 'corner'::text])),
  first_contact_made boolean DEFAULT false,
  first_contact_player_id uuid,
  second_contact_made boolean DEFAULT false,
  second_contact_player_id uuid,
  reached_opponent_box boolean DEFAULT false,
  corner_side text CHECK (corner_side = ANY (ARRAY['left'::text, 'right'::text])),
  created_at timestamp with time zone DEFAULT now(),
  foul_id uuid,
  CONSTRAINT set_pieces_pkey PRIMARY KEY (id),
  CONSTRAINT set_pieces_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT set_pieces_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT set_pieces_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id),
  CONSTRAINT set_pieces_first_contact_player_id_fkey FOREIGN KEY (first_contact_player_id) REFERENCES public.players(id),
  CONSTRAINT set_pieces_second_contact_player_id_fkey FOREIGN KEY (second_contact_player_id) REFERENCES public.players(id),
  CONSTRAINT set_pieces_foul_id_fkey FOREIGN KEY (foul_id) REFERENCES public.fouls(id)
);
CREATE TABLE public.shots_on_target (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  team_id uuid NOT NULL,
  player_id uuid NOT NULL,
  minute integer CHECK (minute >= 0 AND minute <= 130),
  second integer CHECK (second >= 0 AND second <= 59),
  shot_x real CHECK (shot_x >= 0::double precision AND shot_x <= 100::double precision),
  shot_y real CHECK (shot_y >= 0::double precision AND shot_y <= 100::double precision),
  is_goal boolean NOT NULL,
  is_penalty boolean DEFAULT false,
  is_saved boolean DEFAULT false,
  keeper_action_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT shots_on_target_pkey PRIMARY KEY (id),
  CONSTRAINT shots_on_target_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT shots_on_target_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT shots_on_target_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id),
  CONSTRAINT shots_on_target_keeper_action_id_fkey FOREIGN KEY (keeper_action_id) REFERENCES public.keeper_actions(id)
);
CREATE TABLE public.team_leagues (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  team_id uuid NOT NULL,
  league_id uuid NOT NULL,
  is_primary boolean NOT NULL DEFAULT false,
  joined_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT team_leagues_pkey PRIMARY KEY (id),
  CONSTRAINT team_leagues_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT team_leagues_league_id_fkey FOREIGN KEY (league_id) REFERENCES public.leagues(id)
);
CREATE TABLE public.team_profile (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL UNIQUE,
  team_name text NOT NULL,
  league_name text NOT NULL,
  team_tier integer NOT NULL CHECK (team_tier = ANY (ARRAY[1, 2, 3])),
  head_coach_name text NOT NULL,
  team_email text NOT NULL UNIQUE,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT team_profile_pkey PRIMARY KEY (id),
  CONSTRAINT team_profile_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.teams (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  team_name text NOT NULL,
  team_email text UNIQUE,
  user_id uuid UNIQUE,
  head_coach_name text,
  logo_url text,
  has_free_access boolean NOT NULL DEFAULT false,
  is_onboarded boolean NOT NULL DEFAULT false,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT teams_pkey PRIMARY KEY (id),
  CONSTRAINT teams_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email text NOT NULL UNIQUE,
  password_hash text NOT NULL,
  role text NOT NULL CHECK (role = ANY (ARRAY['admin'::text, 'coach'::text, 'player'::text])),
  first_name text,
  last_name text,
  team_id uuid,
  player_id uuid,
  last_login_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT users_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id)
);