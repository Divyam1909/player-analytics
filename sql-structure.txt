-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.duels (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  team_id uuid NOT NULL,
  player_id uuid NOT NULL,
  minute integer CHECK (minute >= 0 AND minute <= 130),
  second integer CHECK (second >= 0 AND second <= 59),
  duel_x real CHECK (duel_x >= 0::double precision AND duel_x <= 100::double precision),
  duel_y real CHECK (duel_y >= 0::double precision AND duel_y <= 100::double precision),
  duel_type text NOT NULL CHECK (duel_type = ANY (ARRAY['aerial'::text, 'dribble'::text])),
  is_successful boolean NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT duels_pkey PRIMARY KEY (id),
  CONSTRAINT duels_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT duels_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT duels_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id)
);
CREATE TABLE public.final_third_chances (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  team_id uuid NOT NULL,
  player_id uuid NOT NULL,
  minute integer CHECK (minute >= 0 AND minute <= 130),
  second integer CHECK (second >= 0 AND second <= 59),
  chance_x real CHECK (chance_x >= 0::double precision AND chance_x <= 100::double precision),
  chance_y real CHECK (chance_y >= 0::double precision AND chance_y <= 100::double precision),
  is_corner boolean NOT NULL,
  corner_type text CHECK (corner_type = ANY (ARRAY['short'::text, 'long'::text])),
  long_corner_success boolean,
  is_in_box boolean,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT final_third_chances_pkey PRIMARY KEY (id),
  CONSTRAINT final_third_chances_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id),
  CONSTRAINT final_third_chances_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT final_third_chances_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id)
);
CREATE TABLE public.frame_cache (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  cache_key text NOT NULL UNIQUE,
  video_id text NOT NULL,
  timestamp_seconds real NOT NULL,
  image_url text NOT NULL,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT frame_cache_pkey PRIMARY KEY (id)
);
CREATE TABLE public.keeper_actions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  team_id uuid NOT NULL,
  player_id uuid NOT NULL,
  minute integer CHECK (minute >= 0 AND minute <= 130),
  second integer CHECK (second >= 0 AND second <= 59),
  action_x real CHECK (action_x >= 0::double precision AND action_x <= 100::double precision),
  action_y real CHECK (action_y >= 0::double precision AND action_y <= 100::double precision),
  action_type text NOT NULL CHECK (action_type = ANY (ARRAY['save'::text, 'collection'::text])),
  save_location text CHECK (save_location = ANY (ARRAY['inside_box'::text, 'outside_box'::text])),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT keeper_actions_pkey PRIMARY KEY (id),
  CONSTRAINT keeper_actions_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT keeper_actions_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT keeper_actions_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id)
);
CREATE TABLE public.knowledge (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  type text NOT NULL,
  title text NOT NULL,
  content text,
  file_url text,
  file_name text,
  summarize boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT knowledge_pkey PRIMARY KEY (id),
  CONSTRAINT knowledge_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.leagues (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  league_name text NOT NULL,
  tier integer CHECK (tier >= 1 AND tier <= 5),
  custom_label text,
  is_default boolean NOT NULL DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  country text,
  state text,
  district text,
  league_type text,
  CONSTRAINT leagues_pkey PRIMARY KEY (id)
);
CREATE TABLE public.match_analytical_maps (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL UNIQUE,
  heatmap_url text,
  touchmap_url text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  chances_created_final_third_team_url text,
  chances_created_final_third_opponent_url text,
  team_final_third_left text,
  team_final_third_center text,
  team_final_third_right text,
  opponent_final_third_left text,
  opponent_final_third_center text,
  opponent_final_third_right text,
  CONSTRAINT match_analytical_maps_pkey PRIMARY KEY (id),
  CONSTRAINT match_analytical_maps_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id)
);
CREATE TABLE public.match_captured_frames (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  user_id uuid NOT NULL,
  timestamp_seconds double precision NOT NULL,
  formatted_time text NOT NULL,
  original_image_url text NOT NULL,
  annotated_image_url text,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  is_exact_frame boolean DEFAULT true,
  CONSTRAINT match_captured_frames_pkey PRIMARY KEY (id),
  CONSTRAINT match_captured_frames_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT match_captured_frames_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.match_highlights (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  timestamp text NOT NULL,
  highlight_type text NOT NULL CHECK (highlight_type = ANY (ARRAY['goal'::text, 'assist'::text, 'shot_on_target'::text, 'save'::text, 'penalty'::text, 'yellow_card'::text, 'red_card'::text, 'offside'::text, 'corner'::text, 'free_kick'::text, 'substitution'::text, 'chances_created'::text, 'cross'::text, 'other'::text])),
  description text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT match_highlights_pkey PRIMARY KEY (id),
  CONSTRAINT match_highlights_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id)
);
CREATE TABLE public.match_performance (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  minute integer NOT NULL CHECK (minute >= 0 AND minute <= 90),
  team_a_performance integer NOT NULL CHECK (team_a_performance >= 0 AND team_a_performance <= 100),
  team_b_performance integer NOT NULL CHECK (team_b_performance >= 0 AND team_b_performance <= 100),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT match_performance_pkey PRIMARY KEY (id),
  CONSTRAINT match_performance_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id)
);
CREATE TABLE public.match_possession (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  minute integer NOT NULL CHECK (minute >= 0 AND minute <= 90),
  team_a_possession integer NOT NULL CHECK (team_a_possession >= 0 AND team_a_possession <= 100),
  team_b_possession integer NOT NULL CHECK (team_b_possession >= 0 AND team_b_possession <= 100),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT match_possession_pkey PRIMARY KEY (id),
  CONSTRAINT match_possession_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id)
);
CREATE TABLE public.match_statistics (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL UNIQUE,
  team_possession integer CHECK (team_possession >= 0 AND team_possession <= 100),
  opponent_possession integer CHECK (opponent_possession >= 0 AND opponent_possession <= 100),
  team_passes integer CHECK (team_passes >= 0),
  opponent_passes integer CHECK (opponent_passes >= 0),
  team_shots_on_target integer CHECK (team_shots_on_target >= 0),
  opponent_shots_on_target integer CHECK (opponent_shots_on_target >= 0),
  team_corners integer CHECK (team_corners >= 0),
  opponent_corners integer CHECK (opponent_corners >= 0),
  team_offsides integer CHECK (team_offsides >= 0),
  opponent_offsides integer CHECK (opponent_offsides >= 0),
  created_at timestamp with time zone DEFAULT now(),
  team_aerial_duels_won integer DEFAULT 0,
  opponent_aerial_duels_won integer DEFAULT 0,
  team_fouls integer DEFAULT 0,
  opponent_fouls integer DEFAULT 0,
  team_chances_created integer DEFAULT 0,
  opponent_chances_created integer DEFAULT 0,
  team_saves integer DEFAULT 0,
  opponent_saves integer DEFAULT 0,
  team_chances_final_third integer DEFAULT 0,
  opponent_chances_final_third integer DEFAULT 0,
  team_performance integer DEFAULT 50,
  opponent_performance integer DEFAULT 50,
  team_clearances integer,
  opponent_clearances integer,
  team_interceptions integer,
  opponent_interceptions integer,
  team_successful_dribbles integer,
  opponent_successful_dribbles integer,
  team_conversion_rate numeric,
  opponent_conversion_rate numeric,
  team_freekicks integer,
  opponent_freekicks integer,
  updated_at timestamp with time zone DEFAULT now(),
  home_possession integer,
  away_possession integer,
  home_passes integer,
  away_passes integer,
  home_shots_on_target integer,
  away_shots_on_target integer,
  home_corners integer,
  away_corners integer,
  home_offsides integer,
  away_offsides integer,
  home_chances_created integer,
  away_chances_created integer,
  home_chances_final_third integer,
  away_chances_final_third integer,
  home_clearances integer,
  away_clearances integer,
  home_interceptions integer,
  away_interceptions integer,
  home_successful_dribbles integer,
  away_successful_dribbles integer,
  home_conversion_rate numeric,
  away_conversion_rate numeric,
  home_ball_recoveries integer,
  away_ball_recoveries integer,
  home_aerial_duels_won integer,
  away_aerial_duels_won integer,
  home_fouls integer,
  away_fouls integer,
  home_saves integer,
  away_saves integer,
  home_freekicks integer,
  away_freekicks integer,
  home_possession_control_index numeric,
  away_possession_control_index numeric,
  home_chance_creation_index numeric,
  away_chance_creation_index numeric,
  home_shooting_efficiency numeric,
  away_shooting_efficiency numeric,
  home_defensive_solidity numeric,
  away_defensive_solidity numeric,
  home_transition_progression numeric,
  away_transition_progression numeric,
  home_recovery_pressing_efficiency numeric,
  away_recovery_pressing_efficiency numeric,
  home_performance integer,
  away_performance integer,
  CONSTRAINT match_statistics_pkey PRIMARY KEY (id),
  CONSTRAINT match_statistics_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id)
);
CREATE TABLE public.match_video_notes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  timestamp text NOT NULL,
  note_text text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  home_notes text,
  away_notes text,
  CONSTRAINT match_video_notes_pkey PRIMARY KEY (id),
  CONSTRAINT match_video_notes_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id)
);
CREATE TABLE public.matches (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  team_id_deprecated uuid NOT NULL,
  is_home_team_deprecated boolean NOT NULL,
  opponent_name_deprecated text NOT NULL,
  team_score integer NOT NULL CHECK (team_score >= 0),
  opponent_score integer NOT NULL CHECK (opponent_score >= 0),
  competition_name text NOT NULL,
  match_date date NOT NULL,
  video_url text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  home_team_id uuid NOT NULL,
  away_team_id uuid NOT NULL,
  our_team_id uuid NOT NULL,
  league_id uuid,
  home_score integer NOT NULL CHECK (home_score >= 0),
  away_score integer NOT NULL CHECK (away_score >= 0),
  home_jersey_color character varying,
  away_jersey_color character varying,
  CONSTRAINT matches_pkey PRIMARY KEY (id),
  CONSTRAINT matches_our_team_id_fkey FOREIGN KEY (our_team_id) REFERENCES public.teams(id),
  CONSTRAINT matches_league_id_fkey FOREIGN KEY (league_id) REFERENCES public.leagues(id),
  CONSTRAINT matches_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id),
  CONSTRAINT matches_home_team_id_fkey FOREIGN KEY (home_team_id) REFERENCES public.teams(id),
  CONSTRAINT matches_away_team_id_fkey FOREIGN KEY (away_team_id) REFERENCES public.teams(id)
);
CREATE TABLE public.pass_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  team_id uuid NOT NULL,
  player_id uuid NOT NULL,
  minute integer CHECK (minute >= 0 AND minute <= 130),
  second integer CHECK (second >= 0 AND second <= 59),
  start_x real CHECK (start_x >= 0::double precision AND start_x <= 100::double precision),
  start_y real CHECK (start_y >= 0::double precision AND start_y <= 100::double precision),
  end_x real CHECK (end_x >= 0::double precision AND end_x <= 100::double precision),
  end_y real CHECK (end_y >= 0::double precision AND end_y <= 100::double precision),
  is_successful boolean NOT NULL,
  is_key_pass boolean DEFAULT false,
  is_progressive_pass boolean DEFAULT false,
  failure_reason text CHECK (failure_reason = ANY (ARRAY['block'::text, 'offside'::text, 'interception'::text])),
  is_assist boolean DEFAULT false,
  assist_pass_type text CHECK (assist_pass_type = ANY (ARRAY['normal'::text, 'key'::text, 'progressive'::text])),
  is_cross boolean DEFAULT false,
  cross_pass_type text CHECK (cross_pass_type = ANY (ARRAY['normal'::text, 'key'::text, 'progressive'::text])),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT pass_events_pkey PRIMARY KEY (id),
  CONSTRAINT pass_events_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT pass_events_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT pass_events_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id)
);
CREATE TABLE public.player_int (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  heading text NOT NULL,
  score text,
  youtube_link text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  team_id uuid NOT NULL,
  home_team_first_half text,
  home_team_second_half text,
  away_team_first_half text,
  away_team_second_half text,
  CONSTRAINT player_int_pkey PRIMARY KEY (id),
  CONSTRAINT player_int_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id)
);
CREATE TABLE public.player_int_notes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  player_int_id uuid NOT NULL,
  user_id uuid NOT NULL,
  timestamp_seconds real NOT NULL CHECK (timestamp_seconds >= 0::double precision),
  note_text text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT player_int_notes_pkey PRIMARY KEY (id),
  CONSTRAINT player_int_notes_player_int_id_fkey FOREIGN KEY (player_int_id) REFERENCES public.player_int(id),
  CONSTRAINT player_int_notes_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.players (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  team_id uuid NOT NULL,
  first_name text NOT NULL,
  last_name text,
  jersey_number integer CHECK (jersey_number >= 1 AND jersey_number <= 99),
  position text CHECK ("position" = ANY (ARRAY['GK'::text, 'CB'::text, 'RB'::text, 'LB'::text, 'RWB'::text, 'LWB'::text, 'CM'::text, 'CDM'::text, 'CAM'::text, 'RW'::text, 'LW'::text, 'ST'::text, 'CF'::text])),
  date_of_birth date,
  nationality text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT players_pkey PRIMARY KEY (id),
  CONSTRAINT players_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id)
);
CREATE TABLE public.schema_baseline (
  table_name text NOT NULL,
  created_via text NOT NULL CHECK (created_via = ANY (ARRAY['migration'::text, 'dashboard'::text, 'unknown'::text])),
  first_migration text,
  rls_enabled boolean NOT NULL DEFAULT false,
  notes text,
  documented_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT schema_baseline_pkey PRIMARY KEY (table_name)
);
CREATE TABLE public.shots_on_target (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  match_id uuid NOT NULL,
  team_id uuid NOT NULL,
  player_id uuid NOT NULL,
  minute integer CHECK (minute >= 0 AND minute <= 130),
  second integer CHECK (second >= 0 AND second <= 59),
  shot_x real CHECK (shot_x >= 0::double precision AND shot_x <= 100::double precision),
  shot_y real CHECK (shot_y >= 0::double precision AND shot_y <= 100::double precision),
  is_goal boolean NOT NULL,
  is_penalty boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT shots_on_target_pkey PRIMARY KEY (id),
  CONSTRAINT shots_on_target_match_id_fkey FOREIGN KEY (match_id) REFERENCES public.matches(id),
  CONSTRAINT shots_on_target_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT shots_on_target_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.players(id)
);
CREATE TABLE public.team_leagues (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  team_id uuid NOT NULL,
  league_id uuid NOT NULL,
  is_primary boolean NOT NULL DEFAULT false,
  joined_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT team_leagues_pkey PRIMARY KEY (id),
  CONSTRAINT team_leagues_team_id_fkey FOREIGN KEY (team_id) REFERENCES public.teams(id),
  CONSTRAINT team_leagues_league_id_fkey FOREIGN KEY (league_id) REFERENCES public.leagues(id)
);
CREATE TABLE public.team_profile (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL UNIQUE,
  team_name text NOT NULL,
  league_name text NOT NULL,
  team_tier integer NOT NULL CHECK (team_tier = ANY (ARRAY[1, 2, 3])),
  head_coach_name text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  team_email text NOT NULL UNIQUE,
  CONSTRAINT team_profile_pkey PRIMARY KEY (id),
  CONSTRAINT team_profile_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.teams (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  team_name text NOT NULL,
  team_email text UNIQUE,
  user_id uuid UNIQUE,
  head_coach_name text,
  logo_url text,
  has_free_access boolean NOT NULL DEFAULT false,
  is_onboarded boolean NOT NULL DEFAULT false,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT teams_pkey PRIMARY KEY (id),
  CONSTRAINT teams_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);